{% extends 'layout.html' %}

{% block title %}
Visualiser Plasmide
{% endblock %}

{% block content %}
<main class="container">
    <div class="page-header">
        <h1>Visualiser le plasmide</h1>
    </div>

    <!-- Messages flash -->
    {% if messages %}
        <div class="mt-3">
            {% for message in messages %}
                <div class="alert {% if message.tags %}alert-{{ message.tags }}{% endif %}" role="alert">
                    {{ message }}
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <!-- Upload Card -->
    <div class="collapse-container mt-3">
        <div class="collapse-header">
            <h3>Uploader un fichier GenBank (.gb)</h3>
        </div>
        <div class="collapse-body">
            <form method="post" enctype="multipart/form-data" action="{% url 'templates:view_plasmid' %}">
                {% csrf_token %}
                <div class="form-group">
                    <label for="plasmid_file">Choisissez un fichier .gb :</label>
                    <input type="file" name="plasmid_file" id="plasmid_file" accept=".gb" required>
                </div>

                <div id="privacy-form" class="mt-3">
                    <input type="checkbox" name="is_public" id="is_public">
                    <label for="is_public">
                        Demander à rendre ce plasmide public
                        <span class="text-sm text-gray-600">(soumis à validation par un administrateur)</span>
                    </label>
                </div>


                <button type="submit" class="btn mt-3">Uploader</button>
            </form>
        </div>
    </div>

    <!-- Bouton Chercher un plasmide -->
    <div class="text-center mt-4">
        <a href="{% url 'templates:search' %}" class="btn btn-primary">Chercher un plasmide</a>
    </div>

    {% if linear_map or circular_map %}
        <div class="simulations-section mt-4">
            <h2>Cartes générées</h2>

            {% if linear_map %}
                <div class="simulation-list mt-3 text-center">
                    <h5>Carte linéaire</h5>
                    <div class="card shadow-sm mt-2 p-2 d-inline-block">
                        <img src="{{ linear_map }}" alt="Carte linéaire" class="img-fluid rounded">
                    </div>
                    <a href="{{ linear_map }}" download class="btn btn-sm btn-outline-primary mt-2">Télécharger la carte linéaire</a>
                </div>
            {% endif %}

            {% if circular_map %}
                <div class="simulation-list mt-4 text-center">
                    <h5>Carte circulaire</h5>
                    <div class="card shadow-sm mt-2 p-2 d-inline-block">
                        <img src="{{ circular_map }}" alt="Carte circulaire" class="img-fluid rounded" style="max-width: 50%;">
                    </div>
                    <a href="{{ circular_map }}" download class="btn btn-sm btn-outline-primary mt-2">Télécharger la carte circulaire</a>
                </div>
            {% endif %}

            <!-- Bouton retour -->
            <div class="mt-4 text-center">
                <a href="{% url 'templates:view_plasmid' %}" class="btn btn-secondary">Retour</a>
            </div>
        </div>
    {% endif %}
</main>
{% endblock %}
